(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-a106"],{CcR8:function(t,e,o){"use strict";o.r(e);var i=o("P2sY"),r=o.n(i),n=o("stgD"),a=(o("ZOF2"),{components:{mavonEditor:n.mavonEditor},data:function(){return{params:{},docForm:{name:"",parentName:"",isShow:"",content:""},rules:{name:[{required:!0,message:"请输入文档名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]},projectForm:{name:"",gitUrl:"",localGitPath:"",gmtCreate:"",gmtUpdate:""},projectFormRules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],gitUrl:[{min:1,max:200,message:"长度在 1 到 200 个字符",trigger:"blur"}],localGitPath:[{min:1,max:200,message:"长度在 1 到 200 个字符",trigger:"blur"}]},templateList:[],addFolderForm:{name:""},addFolderFormRules:{name:[{required:!0,message:"请输入目录名称",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}]},docFormVisible:!1,dialogVisible:!1,filterText:"",data:[],defaultProps:{children:"children",label:"label"},currentTreeId:0,useOnchange:!1,isChanged:!1,isShowReleaseBtn:!1}},watch:{$route:"initData",filterText:function(t){this.$refs.tree.filter(t)}},created:function(){this.initData()},methods:{initData:function(){this.params=this.$route.query,this.docFormVisible=!1,this.resetForms(),this.loadTree(),this.initTemplates(),this.initProjectInfo()},loadTree:function(){var t=this.params.id;if(t){this.params.projectId=t;var e={};e.projectId=t,this.post("doc.treegrid.page",e,function(t){var e=this,o=t.data,i=this.convertToTreeData(o.rows,0);this.data=i,this.$nextTick(function(){e.currentTreeId&&e.$refs.tree.setCurrentKey(e.currentTreeId)})})}},initTemplates:function(){this.post("template.listall",{},function(t){this.templateList=t.data})},initProjectInfo:function(){this.post("project.detail.get",{id:this.params.projectId},function(t){var e=t.data;r()(this.projectForm,e),this.isShowReleaseBtn=this.showReleaseBtn()})},resetForms:function(){var t=this.$refs;for(var e in t)"form"===t[e].$el.localName&&t[e].resetFields()},filterNode:function(t,e){return!t||-1!==e.label.indexOf(t)},onNodeClick:function(t){var e=this;if(!t.parentId)return!1;var o=t.id;o!==this.currentTreeId&&(this.docFormVisible||(this.docFormVisible=!0),this.isChanged?this.$confirm("内容未保存","提示",{confirmButtonText:"立即保存",cancelButtonText:"取消",type:"warning"}).then(function(){e.submitForm(function(){this.doClickNode(o)})}).catch(function(){e.$refs.tree.setCurrentKey(e.currentTreeId)}):this.doClickNode(o))},doClickNode:function(t){this.currentTreeId=t,this.$refs.docForm.resetFields(),this.post("doc.detail.get",{id:t},function(t){var e=this;this.disableOnChange();var o=t.data;o.isShow=o.isShow+"",r()(this.docForm,o),this.$nextTick(function(){e.enableOnChange()})})},convertToTreeData:function(t,e){for(var o=[],i=[],r=0;r<t.length;r++)if(t[r].parentId===e){var n={label:t[r].name,id:t[r].id,parentId:t[r].parentId};(i=this.convertToTreeData(t,t[r].id)).length>0&&(n.children=i),o.push(n)}return o},insertApi:function(t){var e=t.content;this.docForm.content=this.docForm.content+e,console.log(this.docForm.content)},addFolder:function(){this.dialogVisible=!0},closeAddFolderDlg:function(){this.$refs.addFolderForm.resetFields()},addNode:function(t){this.$router.push({path:"/newDoc",query:{parentId:t.id,projectId:this.params.projectId,parentName:t.label}})},delNode:function(t){this.confirm("确认要删除["+t.label+"]吗？",function(e){this.post("doc.delete",{id:t.id},function(){e(),this.tip("删除成功"),this.loadTree()})})},submitForm:function(t){var e=this;this.$refs.docForm.validate(function(o){if(!o)return console.log("error submit!!"),!1;e.post("doc.page.update",e.docForm,function(e){this.isChanged=!1,this.tip("修改成功"),this.loadTree(),t&&t.call(this)})})},showReleaseBtn:function(){return this.projectForm.gitUrl&&this.projectForm.localGitPath},submitFolderForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var o=e.addFolderForm;o.projectId=e.params.projectId,e.post("doc.folder.create",o,function(t){this.dialogVisible=!1,this.loadTree()})})},disableOnChange:function(){this.useOnchange=!1,this.isChanged=!1},enableOnChange:function(){this.useOnchange=!0,this.isChanged=!1},onContentChange:function(t){this.useOnchange&&(this.isChanged=!0)},onContentSave:function(){this.submitForm()},saveProjectInfo:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var o=e.projectForm;o.id=e.params.projectId,e.post("project.update",o,function(){this.tip("修改成功"),this.initProjectInfo()})})},releaseDoc:function(){this.confirm("确认要发布文档吗？",function(t){var e=this.$loading({lock:!0,text:"发布中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o={projectId:this.params.projectId};this.post("project.release",o,function(){t(),e.close(),this.tip("发布成功")})})}}}),s=(o("OGBX"),o("KHd+")),l=Object(s.a)(a,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"app-container"},[t.isShowReleaseBtn?o("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"small",icon:"el-icon-upload"},on:{click:t.releaseDoc}},[t._v("\n    发布文档\n  ")]):t._e(),t._v(" "),o("el-tabs",{attrs:{type:"card"}},[o("el-tab-pane",[o("span",{attrs:{slot:"label"},slot:"label"},[o("i",{staticClass:"el-icon-document"}),t._v(" 文档管理")]),t._v(" "),o("el-container",[o("el-aside",{staticStyle:{"min-height":"300px",width:"200px"}},[o("el-input",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"搜索文档...",size:"mini",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}},[o("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),t._v(" "),o("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-circle-plus-outline"},on:{click:function(e){return e.stopPropagation(),t.addFolder(e)}}},[t._v("\n            添加目录\n          ")]),t._v(" "),o("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:t.data,props:t.defaultProps,"filter-node-method":t.filterNode,"highlight-current":!0,"expand-on-click-node":!1,"empty-text":"无数据","node-key":"id","default-expand-all":""},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var i=e.data;return o("span",{staticClass:"custom-tree-node",on:{click:function(){return t.onNodeClick(i)}}},[i.label.length<15?o("span",[t._v(t._s(i.label))]):o("span",[o("el-tooltip",{staticClass:"item",attrs:{content:i.label,effect:"light",placement:"right"}},[o("span",[t._v(t._s(i.label.substring(0,15)+"..."))])])],1),t._v(" "),o("span",[i.parentId?t._e():o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),t.addNode(i)}}},[t._v("\n                  添加文档\n                ")]),t._v(" "),i.parentId||!i.children||0===i.children.length?o("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete",title:"删除文档"},on:{click:function(e){return e.stopPropagation(),t.delNode(i)}}}):t._e()],1)])}}])})],1),t._v(" "),o("el-main",{directives:[{name:"show",rawName:"v-show",value:t.docFormVisible,expression:"docFormVisible"}],staticStyle:{"padding-top":"0"}},[o("el-form",{ref:"docForm",staticClass:"docFormCls",staticStyle:{width:"100%"},attrs:{inline:!0,model:t.docForm,rules:t.rules}},[o("el-form-item",{attrs:{prop:"name"}},[o("el-input",{staticClass:"doc-title",staticStyle:{width:"600px"},attrs:{placeholder:"文档名称"},model:{value:t.docForm.name,callback:function(e){t.$set(t.docForm,"name",e)},expression:"docForm.name"}},[o("template",{slot:"prepend"},[t._v(t._s(t.docForm.parentName)+" --\x3e")])],2)],1),t._v(" "),o("el-form-item",[o("el-checkbox",{attrs:{"true-label":"1","false-label":"0"},model:{value:t.docForm.isShow,callback:function(e){t.$set(t.docForm,"isShow",e)},expression:"docForm.isShow"}},[t._v("是否显示")])],1),t._v(" "),o("el-form-item",{staticStyle:{"margin-bottom":"0",display:"block"},attrs:{label:"插入模板"}},t._l(t.templateList,function(e){return o("el-button",{key:e.id,attrs:{type:"text"},on:{click:function(o){t.insertApi(e)}}},[t._v(t._s(e.name))])})),t._v(" "),o("mavon-editor",{staticStyle:{"min-height":"500px"},attrs:{boxShadow:!1},on:{change:t.onContentChange,save:t.onContentSave},model:{value:t.docForm.content,callback:function(e){t.$set(t.docForm,"content",e)},expression:"docForm.content"}}),t._v(" "),o("el-form-item",[o("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:function(e){t.submitForm()}}},[t._v("保存")])],1)],1)],1),t._v(" "),o("el-dialog",{attrs:{visible:t.dialogVisible,title:"添加目录",width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.closeAddFolderDlg}},[o("el-form",{ref:"addFolderForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.addFolderForm,rules:t.addFolderFormRules}},[o("el-form-item",{attrs:{label:"目录名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"目录名称"},model:{value:t.addFolderForm.name,callback:function(e){t.$set(t.addFolderForm,"name",e)},expression:"addFolderForm.name"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitFolderForm("addFolderForm")}}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")])],1)],1)],1)],1),t._v(" "),o("el-tab-pane",{attrs:{name:"projectInfoPanel"}},[o("span",{attrs:{slot:"label"},slot:"label"},[o("i",{staticClass:"el-icon-info"}),t._v(" 项目信息")]),t._v(" "),o("el-form",{ref:"projectForm",staticClass:"project-form",attrs:{model:t.projectForm,rules:t.projectFormRules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[o("el-input",{attrs:{placeholder:"文档名称"},model:{value:t.projectForm.name,callback:function(e){t.$set(t.projectForm,"name",e)},expression:"projectForm.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"Git链接",prop:"gitUrl"}},[o("el-input",{attrs:{placeholder:"如：https://gitee.com/xxx/myproject.git"},model:{value:t.projectForm.gitUrl,callback:function(e){t.$set(t.projectForm,"gitUrl",e)},expression:"projectForm.gitUrl"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"本地存放路径",prop:"localGitPath"}},[o("el-input",{attrs:{placeholder:"如：D:/IdeaProjects/myproject"},model:{value:t.projectForm.localGitPath,callback:function(e){t.$set(t.projectForm,"localGitPath",e)},expression:"projectForm.localGitPath"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"创建时间"}},[t._v("\n          "+t._s(t.projectForm.gmtCreate)+"\n        ")]),t._v(" "),o("el-form-item",{attrs:{label:"修改时间"}},[t._v("\n          "+t._s(t.projectForm.gmtUpdate)+"\n        ")]),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.saveProjectInfo("projectForm")}}},[t._v("保存")])],1)],1)],1)],1)],1)},[],!1,null,null,null);l.options.__file="docManager.vue";e.default=l.exports},OGBX:function(t,e,o){"use strict";var i=o("u4bB");o.n(i).a},u4bB:function(t,e,o){}}]);